From 759da0bed570265dabbfc8c1f7921cd9898e68dd Mon Sep 17 00:00:00 2001
From: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Date: Wed, 13 Jan 2021 14:52:22 +0000
Subject: [PATCH] Modify timeout using ioctl

Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
---
 safety-app.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/safety-app.c b/safety-app.c
index 3c2c2a7..664a625 100644
--- a/safety-app.c
+++ b/safety-app.c
@@ -5,6 +5,7 @@
 #include <stdbool.h>
 #include <sys/types.h>
 #include <sys/stat.h>
+#include <linux/watchdog.h>
 //needed for system
 #include <stdlib.h>
 
@@ -56,7 +57,7 @@ bool do_E2Echeck(unsigned char Message[6])
 
 int main(void)
 {
-	int wdt;
+	int wdt, ret, timeout = 10;
 	bool write_wdt = false;
 
 	// creating the communication pipe
@@ -72,6 +73,9 @@ int main(void)
 	wdt = open("/dev/watchdog0", O_WRONLY);
 	if (wdt >= 0)
 		write_wdt = true;
+	ret = ioctl(wdt, WDIOC_SETTIMEOUT, &timeout);
+	if (ret)
+		perror("ioctl");
 
 	while (1) {
 		if (read(fd, Message, 6) > 0) {
-- 
2.20.1

